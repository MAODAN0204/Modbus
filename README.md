# Modbus 電池容量分析工具

## 專案概述

這是一個專門用於分析電池放電數據並計算關鍵電壓參數的Python工具。程式能夠處理CSV格式的測試數據，計算電池容量、放電百分比，並自動找出EDV（End Discharge Voltage）等重要參數。

## 主要功能

- **CSV數據處理**：自動讀取和解析電池測試數據
- **時間序列計算**：計算時間差並轉換為秒數
- **容量計算**：根據電流和時間計算電池容量（mAH）
- **放電百分比分析**：計算並分析電池放電百分比
- **EDV參數提取**：自動找出EDV0、EDV1、EDV2等關鍵電壓值
- **結果輸出**：生成詳細的分析報告並保存為TXT文件

## 檔案結構

```
Modbus/
├── main.py                    # 主程式
├── modbus_calculator.py       # Modbus計算核心模組
├── csv_handler.py            # CSV檔案處理模組
├── backup.py                 # 備份版本主程式
├── main.spec                 # PyInstaller規格檔案
├── main.exe - 捷徑.lnk       # 執行檔捷徑
├── results.txt               # 分析結果輸出檔案
└── MODBUS容量參數範例_20240730/  # 範例數據目錄
    ├── CSV/                  # CSV格式測試數據
    ├── *.xlsx               # Excel格式測試數據
    └── *.txt                # 分析結果文件
```

## 系統需求

- Python 3.7+
- pandas
- decimal (Python內建)
- os (Python內建)

## 安裝與設定

1. 確保已安裝Python 3.7或更新版本
2. 安裝必要的套件：
```bash
pip install pandas
```

## 使用方法

### 執行主程式

```bash
python main.py
```

程式會要求輸入：
1. **CSV檔案路徑**：可以是單一檔案路徑或包含多個CSV檔案的目錄路徑
2. **Shift值**：用於EDV2計算的偏移值

### 輸入格式要求

CSV檔案必須包含以下重要欄位：
- **A欄**：工序標識（必須包含值為3的記錄）
- **L欄**：時間戳記（毫秒）
- **O欄**：電流值
- **P欄**：電壓值
- **DC欄**：放電電壓
- **AD欄**：設備顯示電量
- **AT欄**：滿充容量

## 計算原理

### 時間差計算
```
time = (L[n] - L[n-1]) / 1000  # 將毫秒轉換為秒
```

### 容量計算
```
CAP = (O × time) / 3600  # 計算容量（安時）
SUM = Σ CAP  # 累計容量
```

### 放電百分比
```
PER = (SUM_max - SUM_current) / SUM_max × 100
```

### EDV參數
- **EDV0**：在最接近0%放電時的電壓值
- **EDV1**：在接近3%放電時的電壓值  
- **EDV2**：在接近7%放電時的電壓值減去Shift值

## 輸出結果

程式會產生包含以下資訊的分析報告：
- LOG計算容量（mAH）
- 設備顯示放電電量（mAH）
- GAUGE FullChargeCapacity（mAH）
- EDV0、EDV1、EDV2電壓值

結果會顯示在控制台並保存為對應的TXT檔案。

## 範例數據

專案包含範例測試數據，位於`MODBUS容量參數範例_20240730/`目錄中，可用於測試和學習程式功能。

## 注意事項

1. 確保CSV檔案格式正確，包含必要的欄位
2. A欄必須包含值為3的記錄才會進行計算
3. 程式會自動跳過不符合條件的檔案
4. 建議在處理大量檔案前先用範例數據測試

## 開發資訊

- **開發語言**：Python
- **主要依賴**：pandas, decimal
- **版本控制**：Git
- **打包工具**：PyInstaller

## 故障排除

如果遇到問題，請檢查：
1. CSV檔案格式是否正確
2. 必要欄位是否存在
3. 數據是否包含A=3的記錄
4. Python環境和套件是否正確安裝

## 聯絡資訊

如有問題或建議，請透過專案的Git倉庫提出Issue。 